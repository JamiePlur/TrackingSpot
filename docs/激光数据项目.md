# 激光数据项目



## 问题分析

采用激光数据对行人进行计数的问题中，如果可以准确检测到出现的行人，并能在后续的图像序列中不重复检测，便可实现的对行人的计数。由此，可以分解为以下三个问题：

1. **如何对数据进行有效的可视化**

   一方面，数据的质量可能是精度提升的瓶颈，目前的数据存在跳帧，异常帧的情况。在人数较多时，人工也无法分辨究竟有多少行人。

   另一方面，如何对数据进行可视化处理也会对结果产生影响。目前的数据每一帧图像由250个点组成，所以生成图像可以看作是一个描点的过程。用矩形描点或用圆形描点，用多大的圆形描点，是否有更加巧妙的描点方式，对结果可能会有一定的影响。

2. **如何检测行人目标**

   行人的基本特征有：行人在运动且运动轨迹比较固定（初始位置，结束位置，活动区域），行人的大小比较固定（每个人的脚印大小相仿），行人的形状特点（两个脚印形状）

   基于上述特点，检测行人可能需要采用两类算法：运动检测和识别算法。运动检测算法可以有效的剔除背景，获取目标的运动信息；识别算法可进一步判别行人的纹理信息

3. **如何区分新出现的目标和已检测的目标**

   这个问题可以等效为一个多目标追踪问题：当目标未处于追踪状态，便认为是新的目标，并开始跟踪。当目标处于被追踪状态时，便认为是已检测的目标。

   相比于单目标跟踪问题，多目标问题面临的主要挑战在于行人目标之间的交互和遮挡处理，这可能需要借助于更加合理的匹配方案。



## 解决方案

从问题分析中看到，计数的核心是追踪算法和检测算法。为了简化问题的实现，首先假设：

- 数据的可视化是合理可靠的
- 采用的检测算法是准确无误的
- 采用的跟踪算法是准确无误的

在假设条件下，计数的主体思路可用如下伪代码表示：实时检测新的目标，然后对每一个新目标都增加一个tracker，进行跟踪。当跟踪失败时，认为目标已经离开视野，计数+1

```python

count = 0
objs = []
while True:
	frame = get_frame(video)
    new_objs = detecter(frame)
    for obj in new_objs:
        if is_not_tracked(obj):
        	objs.add(obj)
    		tracker.add(obj)
            
    leaving_objs = tracker.update()
    count += len(objs)
```



具体实现时：追踪算法采用的相关滤波(CSRT)。检测算法首先采用自适应混合高斯模型作背景剔除，然后对检测到的前景进行高斯模糊并进行膨胀，这一步是为了将分开的”两脚“合并成同一个物体。接着提取膨胀后的前景的bounding box，选取大小合理的bounding box 作为检测的目标。



由于假设并不符合实际，在实际测试时，出现了很多的问题

下面是这些问题的描述和相应的解决方案



| 问题                         | 描述                                                         | 解决方案                                                     |
| ---------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 一个目标被识别为两个目标     | 常见情况是两只脚过于分离                                     | 在追踪时，两个目标的运动轨迹相似，所以可以在追踪时判断是否和另一个目标高度重合（通过overlap），如果是，则剔除其中一个 |
| 背景被识别为目标             | 由于背景也在抖动，所以背景有时也会被识别为目标。这个问题其实影响不是很大，因为背景一般不会自行离开视野，但是会占用空间，也会影响其他物体的跟踪 | 这里同时使用了两个方案：       只在特定的人可以活动的区域中检测（十分有效）    记录运动状态，如果目标移动很小，则认为是背景 |
| **两个目标被识别为一个目标** | **两个人并排走会发生这种情况**                               | **调整识别物体大小会好一些，但实际上如果过小的话，会影响跟踪的效果，效果提高不大** |
| 因为异常帧造成了目标丢失     | 在视频中会重新异常帧的情况，可能是有人挡住了雷达，也可能是雷达自身的噪声 | 用帧差法检测异常帧，即两帧差距过大，即认为是异常帧           |
| 因为遮挡造成了目标丢失       | 目标会突然消失，然后再出现                                   | 判断目标离开的位置是否异常                                   |
| **跳帧**                     | **人并没有连续走，而是一直在瞬移**                           | **没有合适的解决方案**                                       |



加重部分表示问题没有解决

目前计数的结果和人眼看的结果大致相仿，但人数偏低一些



## 技术难点和思路



- 跳帧的问题： 

  ​	增强数据的质量，从数据预处理入手

- 处理行人并排或者穿插遮挡的问题：

  ​	通过识别技术，例如svm，神经网络提高算法复杂度

  ​	图匹配算法

  ​	通过光流进行运动轨迹的分类

- 降低算法复杂度问题：

  ​	可以使用简单的算法，允许一定错误的发生，但保证从较长的一段时间观察，false positive 和 true negative的个数相等
